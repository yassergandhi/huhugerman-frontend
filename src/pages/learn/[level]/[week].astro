---
// Usamos los nuevos ALIAS (MÃ¡s limpio, menos error humano)
import Layout from '@layouts/Layout.astro';
import LessonUI from '@components/LessonUI.astro';
import { COURSE_CONFIG } from '@lib/roadmap';

const { level, week } = Astro.params;

// --- ZONA DE DIAGNÃ“STICO FORENSE ---
// Esto imprimirÃ¡ en tu terminal (no en el navegador) quÃ© estÃ¡ pasando realmente.
console.log("\nğŸ” --- INICIO DEBUG DE RUTA ---");
console.log(`ğŸ“ URL Params -> Level: "${level}" | Week: "${week}"`);

// 1. Verificamos si COURSE_CONFIG se importÃ³ bien
if (!COURSE_CONFIG) {
  console.error("âŒ ERROR CRÃTICO: COURSE_CONFIG es undefined. Revisa src/lib/roadmap.js");
  return Astro.redirect('/404');
}

// 2. Imprimimos quÃ© claves (niveles) existen realmente en la configuraciÃ³n
const availableLevels = Object.keys(COURSE_CONFIG);
console.log(`ğŸ“š Niveles disponibles en JS: [${availableLevels.join(', ')}]`);

// 3. NormalizaciÃ³n y BÃºsqueda
const cleanLevel = level?.replace('-', '') || ''; // Quita guiones por si acaso
const levelData = COURSE_CONFIG[cleanLevel];

if (!levelData) {
  console.error(`âŒ FALLO: Buscamos "${cleanLevel}" pero no estÃ¡ en las claves.`);
  return Astro.redirect('/404');
} else {
  console.log(`âœ… Nivel encontrado: ${levelData.title}`);
}

// 4. BÃºsqueda de Semana (MÃ¡s tolerante)
const weekNumber = week?.match(/\d+/)?.[0]; // Extrae "1" de "week1"
console.log(`ğŸ”¢ Buscando semana nÃºmero: ${weekNumber}`);

const lessonData = levelData.weeks.find(w => w.id.includes(`w${weekNumber}`));

if (!lessonData) {
  console.error(`âŒ FALLO: No se encontrÃ³ la semana con patrÃ³n "w${weekNumber}" en el nivel.`);
  // Imprimimos los IDs disponibles para ver por quÃ© falla
  console.log(`   IDs disponibles: ${levelData.weeks.map(w => w.id).join(', ')}`);
  return Astro.redirect('/404');
}

console.log(`âœ… LECCIÃ“N ENCONTRADA: ${lessonData.title}`);
console.log("ğŸ --- FIN DEBUG ---\n");
// --- FIN ZONA DE DIAGNÃ“STICO ---
---

<Layout title={`${lessonData.title} | Huhugerman`}>
  <LessonUI 
    level={cleanLevel} 
    week={week} 
    title={lessonData.title} 
    description="Escribe tu ejercicio y recibe correcciÃ³n instantÃ¡nea." 
  />
</Layout>
